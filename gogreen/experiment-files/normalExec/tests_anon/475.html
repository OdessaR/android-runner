
<html>
<head>
<script>
var testFunc = function() {
        var DEFAULT_MESSAGE = '<!-- BEGIN emergency --><!-- END emergency -->\n<!-- BEGIN non-emergency --><!-- END non-emergency -->\n';

        function check() {
            var timestamp = new Date().getTime();

            // Hardcode the PROD endpoint so it can be requested from anywhere
            var endpoint = '//www.bu.edu/alert/includes/all.html?cachebust=' + timestamp;
                endpoint = '/alert/includes/test-all.html?cachebust=' + timestamp;

            $.ajax({
                url: endpoint,
                timeout: 4000,
                success: function(message) {
                    if (message.length < DEFAULT_MESSAGE.length)
                        error('The response received was shorter than the default message. Message: ' + message);
                    // Do NOT exit on error. Always display WHATEVER we got back. A partial message is better than no message.

                    var component = $('#bu-alert-component,#bu-alert-wrapper');
                    if (component.length == 0)
                        component = $('<div id="bu-alert-component"></div>').prependTo('body');

                    component.html(message);
                },
                error: function(xhr, status, text) {
                    error(endpoint + ' returned non-200 status: ' + status + ' ' + text + ' xhr: ' + JSON.stringify(xhr));
                }
            });

        };

        function error(error) {};

        check();
        setInterval(check, 5000);
    }
</script>
</head>
<body>
<div id="res">Failed</div>
<script>
let failed = true;
try {
    testFunc();
    failed = false;
} catch (e) {
    failed = true;
}

document.getElementById("res").innerHTML = failed ? "Failed" : "Ok";
</script>
</body>
</html>
