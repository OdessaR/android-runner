
<html>
<head>
<script>
var testFunc = function() {
            var carousel = findParentCarousel($(this));

            if (carousel.carouselObj.currentObjectIndex === carousel.carouselObj.carouselItems.length - 1) {
                carousel.carouselObj.currentObjectIndex = 0;
            } else {
                carousel.carouselObj.currentObjectIndex++;
            }

            updateCarousel(carousel.$carousel, carousel.carouselObj);
        });

        $carousel.find(".uscb-prev-spec").click(function() {
            var carousel = findParentCarousel($(this));

            if (carousel.carouselObj.currentObjectIndex === 0) {
                carousel.carouselObj.currentObjectIndex = carousel.carouselObj.carouselItems.length - 1;
            } else {
                carousel.carouselObj.currentObjectIndex--;
            }

            updateCarousel(carousel.$carousel, carousel.carouselObj);
        });

        $carousel.find("div[id^='data-uscb-mini-" + id + "-']").click(function() {
            var carousel = findParentCarousel($(this));

            var miniId = $(this).attr("id");
            var indexId = miniId.replace("data-uscb-mini-" + id + "-", "");

            var index = parseInt(indexId);
            carousel.carouselObj.currentObjectIndex = index;

            updateCarousel(carousel.$carousel, carousel.carouselObj);
        });

        function findParentCarousel($child) {
            var $carousel = $child.closest(".uscb-carousel");
            var id = $carousel.attr("id");
            var carouselObj = _.find(carousels, {
                "id": "" + id + ""
            });

            return {
                $carousel: $carousel,
                carouselObj: carouselObj,
                id: id
            };
        }

        function updateCarousel($carousel, carouselObj) {
            carouselObj.currentObject = carouselObj.carouselItems[carouselObj.currentObjectIndex];

            updateMediaContainer($carousel, carouselObj);
            //Make sure the currentObj.title and teaser are empty b/c the next items may not have value...
            $carousel.find(".uscb-spec-header").text("");
            $carousel.find(".uscb-spec-desc").text("");
            //////
            $carousel.find(".uscb-spec-header").text(carouselObj.currentObject.title);
            $carousel.find(".uscb-spec-desc").html(carouselObj.currentObject.teaser);

            // remove active class
            $carousel.find(".uscb-carousel-spec-mini").each(function(index, element) {
                $(element).removeClass("uscb-active-carousel-special");
            })

            $($carousel.find(".uscb-carousel-spec-mini")[carouselObj.currentObjectIndex]).addClass("uscb-active-carousel-special");

            // dots used on special container
            // remove active class
            $carousel.find(".uscb-dot-spec").each(function(index, element) {
                $(element).removeClass("uscb-active-carousel");
            })
            $($carousel.find(".uscb-dot-spec")[carouselObj.currentObjectIndex]).addClass("uscb-active-carousel");

        }

        function updateMediaContainer($carousel, carouselObj) {
            if (carouselObj.currentObject.mediaType.toLowerCase() === 'image') {

                var mediaContainerMarkup = "";
                if (carouselObj.currentObject.ctaUrl) {
                    mediaContainerMarkup += '<a href="' + carouselObj.currentObject.ctaUrl + '" class="data-uscb-carousel-cta-link uscb-text-decoration-none">';
                }

                mediaContainerMarkup += '<div class="uscb-carousel-spec-img">';
                mediaContainerMarkup += '<img src="' + carouselObj.currentObject.image + '" id="uscb-carousel-img-spec" alt="">';
                mediaContainerMarkup += '</div>';

                if (carouselObj.currentObject.ctaUrl) {
                    mediaContainerMarkup += '</a>';
                }


                $carousel.find(".data-uscb-carousel-cta-link").attr("href", carouselObj.currentObject.ctaUrl);

                if (carouselObj.currentObject.ctaText) {
                    $carousel.find(".data-uscb-spec-button").show();
                    $carousel.find(".data-uscb-spec-button").text(carouselObj.currentObject.ctaText);
                } else {
                    if (carouselObj.currentObject.ctaUrl) {
                        $carousel.find(".data-uscb-spec-button").show();
                        $carousel.find(".data-uscb-spec-button").text("View More");
                    } else {
                        $carousel.find(".data-uscb-spec-button").hide();
                    }
                }

            } else if (carouselObj.currentObject.mediaType.toLowerCase() === 'video') {

                var mediaContainerMarkup =
                    "<iframe src='//www.youtube.com/embed/" + carouselObj.currentObject.video + "?wmode=opaque&rel=0' height='100%' width='100%' frameborder='0' allowfullscreen>Loading Video...</iframe>";

                $carousel.find(".data-uscb-carousel-cta-link").attr("href", "");
                $carousel.find(".data-uscb-spec-button").hide();
            }
        }
</script>
</head>
<body>
<div id="res">Failed</div>
<script>
let failed = true;
try {
    testFunc();
    failed = false;
} catch (e) {
    failed = true;
}

document.getElementById("res").innerHTML = failed ? "Failed" : "Ok";
</script>
</body>
</html>
