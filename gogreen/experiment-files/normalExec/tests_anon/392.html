
<html>
<head>
<script>
var testFunc = function() {
        BODY = DOC.body;

    var getTagName = function(ele) {
        return ele.tagName.toUpperCase();
    }
    var formatDate = function(d) {
        var str = "yyMMddhhmmss";
        var month = d.getMonth() + 1;

        str = str.replace(/yy/, (d.getYear() % 100) > 9 ? (d.getYear() % 100).toString() : '0' + (d.getYear() % 100));
        str = str.replace(/MM/, month > 9 ? month.toString() : '0' + month);
        str = str.replace(/dd/, d.getDate() > 9 ? d.getDate().toString() : '0' + d.getDate());
        str = str.replace(/hh/, d.getHours() > 9 ? d.getHours().toString() : '0' + d.getHours());
        str = str.replace(/mm/, d.getMinutes() > 9 ? d.getMinutes().toString() : '0' + d.getMinutes());
        str = str.replace(/ss/, d.getSeconds() > 9 ? d.getSeconds().toString() : '0' + d.getSeconds());

        return str;
    }
    var setCookie = function(name, value, expires, path, domain, secure) {
            ((expires) ? "; expires=" + expires.toGMTString() : "") +
            ((path) ? "; path=" + path : "") +
            ((domain) ? "; domain=" + domain : "") +
            ((secure) ? "; secure" : "");
    }
    var getCookie = function(cname) {
        return cookieStr ? unescape(cookieStr[1]) : "";
    }
    var count = function(event) {
        var tar = event.srcElement || event.target;
        var tname = getTagName(tar);

        if (tname == "A" || tname == "IMG" || tname == "SPAN" || tname == "B") {
            if (tname != "A") {
                do {
                    tar = tar.parentNode;
                    if (getTagName(tar) == "A") {
                        break;
                    }
                } while (tar && getTagName(tar) != "BODY");

                if (!tar || getTagName(tar) == "BODY") {
                    return;
                }
            }
        } else {
            return;
        }

        var oHref = tar.href;
        var pids = [],
            node, pid;
        var reg1 = /#$/,
            reg2 = /^javascript\:/,
            reg3 = /^S\d{1,2}_?/;
        //!reg1.test(oHref)&&
        if (!reg2.test(oHref)) {
            node = tar;
            do {
                node = node.parentNode;
                pid = node.id;
                if (pid != "" && reg3.test(pid)) {
                    pids.push(pid);
                }
            } while (node && getTagName(node) != "BODY");

            if (pids.length < 2) {
                for (var i = 0; i <= 2 - pids.length; i++) {
                    pids.push("");
                }
            }
            var ts = formatDate(new Date());
            var exp = new Date();
            exp.setTime(exp.getTime() + 120 * 1000);
        }
    }
    if (BODY.attachEvent) {
        BODY.attachEvent("onclick", function(event) {
            count(event);
        });
    } else {
        BODY.addEventListener("click", count, false);
    }
}
</script>
</head>
<body>
<div id="res">Failed</div>
<script>
let failed = true;
try {
    testFunc();
    failed = false;
} catch (e) {
    failed = true;
}

document.getElementById("res").innerHTML = failed ? "Failed" : "Ok";
</script>
</body>
</html>
