
<html>
<head>
<script>
var testFunc = function() {
        $('form[name="signup"] select.index').cssSelect();
        if ($("html").hasClass("lt-ie10")) {
            $('form[name="signup"] input[placeholder]').placeholder();
        }
        $('form[name="signup"] input[type="text"]:first').trigger('focus').val('');
        $('form[name="signup"] input').on('focus', function(event) {
            $(this).closest('label').siblings('label').removeClass('active');
            $(this).closest('label').addClass('active');
        });
        $('form[name="signup"] a[href^="/Signup"]').on('click', function(event) {
            $(this).closest('form').trigger('userSubmit');
            event.preventDefault();
        });
        $('form[name="signup"]').on('userSubmit', submit);
        $('form[name="signup"]').on('validation', setState);
        $('form[name="signup"] input').on('keydown', function(event) {
            if (event.keyCode === 13) $('form[name="signup"]').trigger('userSubmit');
        });
        $('form[name="signup"] input[name="emailAddress"]').on('blur', function(event) {
            var $emailInput = $('form[name="signup"]').find('input[name="emailAddress"]');
            if ($emailInput.val().length < 1 || $emailInput.hasClass('placeholder')) {
                return;
            }
            validateEmail($emailInput.val());
        });
        $('form[name="signup"] input[name="password"]').on('blur', function(event) {
            var $passwordInput = $('form[name="signup"]').find('input[name="password"]');
            if ($passwordInput.val().length < 1 || $passwordInput.hasClass('placeholder')) {
                return;
            }
            validatePassword($passwordInput.val());
        });
        $('form[name="signup"] select#category').on('change', function(event) {
            $('input[name="subCategory"]').val($(this).find(':selected').data('subcategory'));
        });
    });

    function setState(event, validationData) {
        $(validationData.el.selector)[0].className = validationData.state;
        changeText(validationData.el);
    }

    function changeText(el) {
        $(el.selector).find('p').text(el.text);
    }

    function submit(event) {
        var email = $(this).find('input[name="emailAddress"]').val();
        var password = $(this).find('input[name="password"]').val();
        var category = $(this).find('select[name="category2"]').val();
        var defaultAction = $(this).attr('action');
        if (validateEmail(email) && validatePassword(password) && validateCategory(category)) {
            $(this).attr('action', $(this).attr('data-action'));
            $(this).submit();
            return false;
        } else {
            if (defaultAction) {
            }
            return false;
        }
    }

    function validateCategory(category) {
        var selector = 'label[for="category"]';
        var valid = !!category;
        if (!valid) {
            $('form[name="signup"]').trigger('validation', {
                state: 'error',
                el: {
                    selector: selector,
                    text: translate('webs.external.index.signup.category.invalid')
                }
            });
            return false;
        }
        $('form[name="signup"]').trigger('validation', {
            state: '',
            el: {
                selector: selector,
                text: translate('webs.external.index.signup.category.label')
            }
        });
        return true;
    }

    function validateEmail(email) {
        var selector = 'label[for="emailAddress"]';
        var valid = EXTERNAL_CONSTANTS.rValidWebsId.test(email);
        if (!valid) {
            $('form[name="signup"]').trigger('validation', {
                state: 'error',
                el: {
                    selector: selector,
                    text: translate('webs.external.index.signup.email.invalid')
                }
            });
            return false;
        }
        $('form[name="signup"]').trigger('validation', {
            state: '',
            el: {
                selector: selector,
                text: translate('webs.external.index.signup.email.label')
            }
        });
        return true;
    }

    function validatePassword(password) {
        var selector = 'label[for="password"]';
        if (password.length < 4) {
            $('form[name="signup"]').trigger('validation', {
                state: 'error',
                el: {
                    selector: selector,
                    text: translate('webs.external.index.signup.password.invalid.short')
                }
            });
            return false;
        }
        if (password[0] === " " || password[password.length - 1] === " ") {
            $('form[name="signup"]').trigger('validation', {
                state: 'error',
                el: {
                    selector: selector,
                    text: translate('webs.external.index.signup.password.invalid.space')
                }
            });
            return false;
        }
        if (!EXTERNAL_CONSTANTS.isSafeAscii(password)) {
            $('form[name="signup"]').trigger('validation', {
                state: 'error',
                el: {
                    selector: selector,
                    text: translate('webs.external.index.signup.password.invalid.ascii')
                }
            });
            return false;
        }
        $('form[name="signup"]').trigger('validation', {
            state: '',
            el: {
                selector: selector,
                text: translate('webs.external.index.signup.password.valid')
            }
        });
        return true;
    }
</script>
</head>
<body>
<div id="res">Failed</div>
<script>
let failed = true;
try {
    testFunc();
    failed = false;
} catch (e) {
    failed = true;
}

document.getElementById("res").innerHTML = failed ? "Failed" : "Ok";
</script>
</body>
</html>
